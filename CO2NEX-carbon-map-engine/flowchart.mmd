%%{init: {
  'theme': 'default',
  'themeVariables': {
    'fontSize': '16px',
    'primaryColor': '#2c3e50',
    'primaryBorderColor': '#34495e',
    'primaryTextColor': '#ecf0f1',
    'edgeLabelBackground':'#ffffff',
    'clusterBkg': '#ecf0f1',
    'clusterBorder': '#bdc3c7',
    'lineColor': '#7f8c8d',
    'tertiaryColor': '#e0f7fa'
  },
  'themeConfig': {
    'nodeTextMargin': 6,
    'padding': 15
  },
  'flowchart': {
    'useMaxWidth': false,
    'htmlLabels': true,
    'curve': 'basis'
  }
}}%%

graph TD
    %% =========================
    %%   ðŸ§  PROJECT OVERVIEW
    %% =========================
    A0[ðŸ›°ï¸ CO2NEX Carbon Map Engine]:::main
    A1[ðŸŽ¯ Goal: Real-Time Carbon Dashboard]:::goal
    A0 --> A1

    %% =========================
    %%   ðŸ—ºï¸ MAP CONTENT
    %% =========================
    A1 --> B0[ðŸ—‚ï¸ Map Content Layers]:::content
    B0 --> B1[ðŸŒ Verified States & Biomes]
    B0 --> B2[ðŸ“ GeoJSON Parcel Boundaries]
    B0 --> B3[ðŸ“¸ GeoTagged Site Photos]
    B0 --> B4[ðŸ§ª Lab Reports: Soil/Water/Biomass]
    B0 --> B5[ðŸ§  AI + Satellite Carbon Calculations]
    B0 --> B6[â±ï¸ Live Carbon Sequestration]
    B0 --> B7[ðŸ“ˆ Credit Issuance by Parcel]

    %% =========================
    %%   ðŸ§© MAP LAYERS
    %% =========================
    B0 --> C0[ðŸ—ºï¸ Visual Map Layers]:::layers
    C0 --> C1[ðŸ›°ï¸ Satellite Imagery]
    C0 --> C2[ðŸŒ„ Terrain + NDVI]
    C0 --> C3[ðŸ“ Parcel Layer]
    C0 --> C4[ðŸŒ± Biome Overlay]
    C0 --> C5[ðŸ“Œ Sampling Points]
    C0 --> C6[ðŸŒ¿ Vegetation/Biomass Layer]
    C0 --> C7[ðŸŒ¡ï¸ Carbon Calc Overlay]
    C0 --> C8[ðŸ“¸ Photo Popups]
    C0 --> C9[ðŸ“„ Lab Downloads]

    %% =========================
    %%   ðŸ” DATA PIPELINE
    %% =========================
    B0 --> D0[ðŸ“¥ Data Collection]:::data
    D0 --> D1[ðŸ“· Site Photos JPG + GPS]
    D0 --> D2[ðŸ§ª Soil Data PDF/CSV]
    D0 --> D3[ðŸ’§ Water Samples]
    D0 --> D4[ðŸŒ¾ Biomass Density]
    D0 --> D5[ðŸ›°ï¸ Satellite Metrics NDVI/LST]
    D0 --> D6[ðŸ§  AI Carbon Estimate]
    D0 --> D7[ðŸ§¾ Landowner Metadata]
    D0 --> D8[ðŸ“„ Credit Issuance Docs]

    %% =========================
    %%   ðŸ§  AI / SATELLITE
    %% =========================
    B5 --> E0[ðŸ§  AI + Satellite Module]:::ai
    E0 --> E1[ðŸ›°ï¸ Sentinel / Landsat Inputs]
    E1 --> E2[ðŸ“Š NDVI, EVI, Moisture Models]
    E2 --> E3[ðŸŒ¿ Biomass via GEE]
    E3 --> E4[ðŸ¤– TensorFlow / ML Models]
    E4 --> E5[ðŸŽ¯ Confidence Score Layers]

    %% =========================
    %%   ðŸ‘€ USER INTERFACE
    %% =========================
    B0 --> F0[ðŸ–¥ï¸ User Dashboard]:::ui
    F0 --> F1[ðŸ” Zoomed Parcel View]
    F0 --> F2[ðŸ§­ Toggle Satellite/Biome Layers]
    F0 --> F3[ðŸ“¸ Popups: Photos + Reports]
    F0 --> F4[â±ï¸ Popups: Carbon + Timestamps]
    F0 --> F5[ðŸ“Š Dashboard: Total Stored Carbon]
    F0 --> F6[ðŸ“ˆ Dashboard: Annual Sequestration]
    F0 --> F7[ðŸ” Verification Source Display]

    %% =========================
    %%   ðŸ§± TECH STACK
    %% =========================
    A0 --> G0[ðŸ§± Tech Stack]:::tech
    G0 --> G1[ðŸŒ Google Earth Engine]
    G0 --> G2[ðŸ”¥ Firebase / Supabase]
    G0 --> G3[âš›ï¸ React / Next.js]
    G0 --> G4[ðŸ—ºï¸ Leaflet / Mapbox]
    G0 --> G5[â˜ï¸ Cloud / IPFS Storage]
    G0 --> G6[ðŸ“Ž QR Code Integration]

    %% =========================
    %%   ðŸ“… NEXT STEPS
    %% =========================
    A0 --> H0[ðŸ“… Execution Plan]:::plan
    H0 --> H1[ðŸ§­ Finalize State + Biome Maps]
    H0 --> H2[ðŸ“¸ Structure Site Visit Uploads]
    H0 --> H3[ðŸ“ Build First GeoJSON Parcel]
    H0 --> H4[ðŸ§  GEE Integration Script]
    H0 --> H5[ðŸŒ Publish Public Dashboard]
    H0 --> H6[ðŸ”— Add Shareable QR Links]

    %% =========================
    %%   CLASS DEFINITIONS
    %% =========================
    classDef main fill:#2c3e50,stroke:#34495e,color:#ecf0f1,font-weight:bold
    classDef goal fill:#27ae60,stroke:#2ecc71,color:#ffffff
    classDef content fill:#3498db,stroke:#2980b9,color:#ffffff
    classDef layers fill:#9b59b6,stroke:#8e44ad,color:#ffffff
    classDef data fill:#f39c12,stroke:#e67e22,color:#ffffff
    classDef ai fill:#e74c3c,stroke:#c0392b,color:#ffffff
    classDef ui fill:#1abc9c,stroke:#16a085,color:#ffffff
    classDef tech fill:#7f8c8d,stroke:#95a5a6,color:#ffffff
    classDef plan fill:#34495e,stroke:#2c3e50,color:#ffffff
